<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>거래 검색</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="container mt-5">
    <h2>거래 검색</h2>
    <form action="/search" method="GET">
        <div class="form-group">
            <label for="region">지역</label>
            <select id="region" name="region" class="form-control" required>
                <option value="">선택하세요</option>
                <th:block th:each="entry : ${locations}">
                    <option th:value="${entry.value}" th:text="${entry.key}"></option>
                </th:block>
            </select>
        </div>
        <div class="form-group">
            <label for="locationName">세부 지역</label>
            <select id="locationName" name="locationName" class="form-control" required>
                <option value="">선택하세요</option>
                <!-- 세부 지역은 JavaScript를 통해 동적으로 추가됩니다 -->
            </select>
        </div>
        <div class="form-group">
            <label for="minPrice">최소 가격</label>
            <input type="number" class="form-control" id="minPrice" name="minPrice">
        </div>
        <div class="form-group">
            <label for="maxPrice">최대 가격</label>
            <input type="number" class="form-control" id="maxPrice" name="maxPrice">
        </div>
        <button type="submit" class="btn btn-primary">검색</button>
    </form>
</div>

<script>
    $(document).ready(function() {
        $('#region').change(function() {
            var regionCode = $(this).val(); // 선택된 지역 코드 가져오기

            $('#locationName').empty().append('<option value="">선택하세요</option>'); // 세부 지역 드롭다운 초기화

            if (regionCode) {
                // AJAX 요청을 통해 세부 지역 가져오기
                $.get('/sub-locations', { regionCode: regionCode }, function(data) {
                    data.forEach(function(loc) {
                        $('#locationName').append('<option value="' + loc + '">' + loc + '</option>');
                    });
                });
            }
        });
    });
</script>
</body>
</html>
