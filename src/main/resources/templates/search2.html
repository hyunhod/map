<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>거래 검색</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="container mt-5">
    <h2>거래 검색</h2>
    <form action="/search1" method="GET">
        <div class="form-group">
            <label for="region">지역</label>
            <select id="region" name="region" class="form-control" required>
                <option value="">선택하세요</option>
                <th:block th:each="entry : ${locations}">
                    <option th:value="${entry.value}" th:text="${entry.key}"></option>
                </th:block>
            </select>
        </div>
        <div class="form-group">
            <label for="locationName">세부 지역</label>
            <select id="locationName" name="locationName" class="form-control" required>
                <option value="">선택하세요</option>
                <!-- 세부 지역은 JavaScript를 통해 동적으로 추가됩니다 -->
            </select>
        </div>
        <div class="form-group">
            <label for="minPrice">최소 가격</label>
            <input type="number" class="form-control" id="minPrice" name="minPrice" placeholder="최소 가격을 입력하세요">
        </div>
        <div class="form-group">
            <label for="maxPrice">최대 가격</label>
            <input type="number" class="form-control" id="maxPrice" name="maxPrice" placeholder="최대 가격을 입력하세요">
        </div>
        <div class="form-group">
            <label for="minArea">최소 면적 (㎡)</label>
            <input type="number" class="form-control" id="minArea" name="minArea" placeholder="최소 면적을 입력하세요">
        </div>
        <div class="form-group">
            <label for="maxArea">최대 면적 (㎡)</label>
            <input type="number" class="form-control" id="maxArea" name="maxArea" placeholder="최대 면적을 입력하세요">
        </div>
        <div class="form-group">
            <label for="dealDate">거래 날짜</label>
            <input type="date" class="form-control" id="dealDate" name="dealDate">
        </div>
        <div class="form-group">
            <label for="sortBy">정렬 기준</label>
            <select id="sortBy" name="sortBy" class="form-control">
                <option value="">선택하세요</option>
                <option value="dealAmount">거래 금액순</option>
                <option value="buildYear">건축년도순</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">검색</button>
    </form>
</div>

<script>
    $(document).ready(function() {
       $('#region').change(function() {
           var regionCode = $(this).val(); // 선택된 지역 코드 가져오기

           $('#locationName').empty().append('<option value="">선택하세요</option>'); // 세부 지역 드롭다운 초기화

           if (regionCode) {
               // AJAX 요청을 통해 세부 지역 가져오기
               $.get('/sub-locations', { regionCode: regionCode }, function(data) {
                   data.forEach(function(loc) {
                       $('#locationName').append('<option value="' + loc + '">' + loc + '</option>');
                   });
               });
           }
       });

       // 세부 지역 드롭다운이 업데이트 된 후에 이벤트 리스너 추가
       $('#locationName').on('change', function() {
           var selectedLocationCode = $(this).val(); // 선택된 세부 지역 코드 가져오기
           console.log('선택된 세부 지역 코드:', selectedLocationCode); // 콘솔에 로그 찍기
       });
   });

</script>
</body>
</html>
